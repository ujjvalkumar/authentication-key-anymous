aW1wb3J0IGphdmEuYXd0LkNvbG9yOwppbXBvcnQgamF2YS5hd3QuQ29udGFpbmVyOwppbXBvcnQgamF2YS5hd3QuRm9udDsKaW1wb3J0IGphdmEuYXd0Lk1lbnU7CmltcG9ydCBqYXZhLmF3dC5NZW51QmFyOwppbXBvcnQgamF2YS5hd3QuTWVudUl0ZW07CmltcG9ydCBqYXZhLmF3dC5ldmVudC5BY3Rpb25FdmVudDsKaW1wb3J0IGphdmEuYXd0LmV2ZW50LkFjdGlvbkxpc3RlbmVyOwppbXBvcnQgamF2YS5pby5CdWZmZXJlZElucHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5EYXRhSW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkRhdGFPdXRwdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkZpbGVJbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uRmlsZU91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUHJpbnRTdHJlYW07CmltcG9ydCBqYXZhLm1hdGguQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEubmV0LlNlcnZlclNvY2tldDsKaW1wb3J0IGphdmEubmV0LlNvY2tldDsKaW1wb3J0IGphdmEuc2VjdXJpdHkuRGlnZXN0SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLnNlY3VyaXR5LktleTsKaW1wb3J0IGphdmEuc2VjdXJpdHkuS2V5UGFpcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuS2V5UGFpckdlbmVyYXRvcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuTWVzc2FnZURpZ2VzdDsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9ydCBqYXZhLnNxbC5Ecml2ZXJNYW5hZ2VyOwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0TWV0YURhdGE7CmltcG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnRleHQuRGF0ZUZvcm1hdDsKaW1wb3J0IGphdmEudGV4dC5TaW1wbGVEYXRlRm9ybWF0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51dGlsLlZlY3RvcjsKaW1wb3J0IGphdmF4LmNyeXB0by5DaXBoZXI7CmltcG9ydCBqYXZheC5zd2luZy5Cb3JkZXJGYWN0b3J5OwppbXBvcnQgamF2YXguc3dpbmcuSW1hZ2VJY29uOwppbXBvcnQgamF2YXguc3dpbmcuSkJ1dHRvbjsKaW1wb3J0IGphdmF4LnN3aW5nLkpDb21ib0JveDsKaW1wb3J0IGphdmF4LnN3aW5nLkpGcmFtZTsKaW1wb3J0IGphdmF4LnN3aW5nLkpMYWJlbDsKaW1wb3J0IGphdmF4LnN3aW5nLkpPcHRpb25QYW5lOwppbXBvcnQgamF2YXguc3dpbmcuSlBhbmVsOwppbXBvcnQgamF2YXguc3dpbmcuSlNjcm9sbFBhbmU7CmltcG9ydCBqYXZheC5zd2luZy5KVGFibGU7CmltcG9ydCBqYXZheC5zd2luZy5KVGV4dEFyZWE7CmltcG9ydCBqYXZheC5zd2luZy5KVGV4dEZpZWxkOwppbXBvcnQgamF2YXguc3dpbmcuVGltZXI7CmltcG9ydCBqYXZheC5zd2luZy5VSU1hbmFnZXI7CmltcG9ydCBqYXZheC5zd2luZy5ib3JkZXIuQm9yZGVyOwoKcHVibGljIGNsYXNzIEtEQyBpbXBsZW1lbnRzIEFjdGlvbkxpc3RlbmVyIHsKCUpGcmFtZSBqZjsKCUNvbnRhaW5lciBjOwoJSkxhYmVsIGwxLCBsMiwgbDMsIGw0LCBsNSwgbDYsIGw3LCBsOCwgbDksIGwxMCwgbDExLCBsMTI7CglKUGFuZWwgcDEsIHAyOwoJSkJ1dHRvbiBiMSxiMiwgYjMsIGI0OwoJSlNjcm9sbFBhbmUgc3A7CglKVGV4dEFyZWEgdGE7CglKVGV4dEZpZWxkIHQxOwoJTWVudUJhciBtYnI7CglNZW51IGZpbGU7CglNZW51SXRlbSAgaXRlbTIsaXRlbTIyLCB1c2Vycyxjc2ZpbGUsZXhpdDsKCUJvcmRlciBiMTEsIGIyMiwgYjMzOwoJSlNjcm9sbFBhbmUgcGFuZTsKCVN0cmluZyBTY2hlbWUxLCByYW5rOwoJU3RyaW5nIGYxID0gIiIsIGYyID0gIiIsIGYzID0gIiIsIGY0ID0gIiIsIGY1ID0gIiIsIGY2ID0gIiIsIGY3ID0gIiIsZjggPSAiIjsKCWludCBjb3VudCA9IDA7CglUaW1lciB0aW1lcjsKCQoJcHVibGljIHN0YXRpYyBLZXkgcHViS2V5OwoJc3RhdGljIENpcGhlciBlbmNvZGVyOwoJCglJbWFnZUljb24gb25lLHR3byx0aHJlZSxmb3VyLGFycm93MSxhcnJvdzIsYXJyb3czLGFycm93NCxhcnJvdzUsYXJyb3c2OwoJSkxhYmVsIG9uZWwsdHdvbCx0aHJlZWwsZm91cmwsYXJyb3cxbCxhcnJvdzJsLGFycm93M2wsYXJyb3c0bCxhcnJvdzVsLGFycm93NmwsYXJyb3c3bCxhcnJvdzhsOwoJSkxhYmVsIGxhYjEsbGFiMixsYWIzLGxhYjQsbGFiNSxsYWI2LGxhYjcsbGFiOCxsYWI5LGxhYjEwLGxhYjExOwoJCgkKCXB1YmxpYyBGb250IGYgPSBuZXcgRm9udCgiVGltZXMgbmV3IHJvbWFuIiwgRm9udC5CT0xELCAxNCk7CglwdWJsaWMgRm9udCBmb250ID0gbmV3IEZvbnQoIlRpbWVzIG5ldyByb21hbiIsIEZvbnQuQk9MRCwgMTgpOwoJCglKTGFiZWwgbWcxLCBtZzIsIG1nMywgbWc0LCBtZzUsIG1nNiwgbWc3LCBtZzgsIG1nOSwgbWcxMCwgZzExLCBnMjIsIGczMywKCQkJZzQ0LCBnNTUsIGc2NiwgZzc3OwoKCQoJU3RyaW5nIGtleVdvcmQgPSAiZWY1MGEwZWYyYzNlM2E1ZmRmODAzYWU5NzUyYzhjNjYiOwoKCUtEQygpIHsKCQlqZiA9IG5ldyBKRnJhbWUoIktEQyA6OkF1dGhlbnRpY2F0ZWQgS2V5IEV4Y2hhbmdlIFByb3RvY29scyBmb3IgUGFyYWxsZWwgTmV0d29yayBGaWxlIFN5c3RlbXMiKTsKCQljID0gamYuZ2V0Q29udGVudFBhbmUoKTsKCQljLnNldExheW91dChudWxsKTsKCQkKCQltYnIgPSBuZXcgTWVudUJhcigpOwoJCWZpbGUgPSBuZXcgTWVudSgiS0RDIik7CgkJaXRlbTI9IG5ldyBNZW51SXRlbSgiU2NoZWR1bGUgRGF0ZSIpOwoJCWl0ZW0yMj0gbmV3IE1lbnVJdGVtKCJWaWV3IFNjaGVkdWxlZCBEYXRlIik7CgkJaXRlbTIuYWRkQWN0aW9uTGlzdGVuZXIodGhpcyk7CgkJaXRlbTIyLmFkZEFjdGlvbkxpc3RlbmVyKHRoaXMpOwoJCWZpbGUuYWRkKGl0ZW0yKTsKCQlmaWxlLmFkZChpdGVtMjIpOwoJCW1ici5hZGQoZmlsZSk7CgkJamYuc2V0TWVudUJhcihtYnIpOwoJCWMuc2V0QmFja2dyb3VuZChDb2xvci5XSElURSk7CgkJdGltZXIgPSBuZXcgVGltZXIoMCwgbnVsbCk7CgkJCgkJYjE9bmV3IEpCdXR0b24oIktEQyIpOwoJCWIxLnNldEJvdW5kcygyMDAsIDMwMCwgMTIwLCAzMCk7CgkJYjEuYWRkQWN0aW9uTGlzdGVuZXIodGhpcyk7CgkJCgkJYy5hZGQoYjEpOwoJCQoJCWpmLnNldEJvdW5kcyg0MCwgMCwgNTUwLDQwMCk7CgkJamYuc2hvdygpOwoKCQlpbnRbXSBwb3J0cyA9IG5ldyBpbnRbXSB7MTMzM307CgkJCgkJZm9yIChpbnQgaSA9IDA7IGkgPCAxOyBpKyspIHsKCQkJVGhyZWFkIHQyID0gbmV3IFRocmVhZChuZXcgUG9ydExpc3RlbmVyKHBvcnRzW2ldKSk7CgkJCXQyLnN0YXJ0KCk7CgkJfQoJfQoKCXB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZyBhcmdzW10pCgl7Ci8vCQluZXcgQ2xvdWRTZXJ2ZXIoKTsKCQl0cnkgewoJCQlVSU1hbmFnZXIKCQkJCQkuc2V0TG9va0FuZEZlZWwoImNvbS5zdW4uamF2YS5zd2luZy5wbGFmLndpbmRvd3MuV2luZG93c0xvb2tBbmRGZWVsIik7CgkJfSBjYXRjaCAoRXhjZXB0aW9uIGUxKSB7CgkJCWUxLnByaW50U3RhY2tUcmFjZSgpOwoJCX0KCQlqYXZhLmF3dC5FdmVudFF1ZXVlLmludm9rZUxhdGVyKG5ldyBSdW5uYWJsZSgpIHsKCQkJcHVibGljIHZvaWQgcnVuKCkgewoJCQkJbmV3IEtEQygpOwoJCQkJY2FsbCgpOwoJCQl9CgoJCQkgdm9pZCBjYWxsKCkgewoKCQkJCSB0cnkKCQkJCSB7CgkJCQkJIENsYXNzLmZvck5hbWUoImNvbS5teXNxbC5qZGJjLkRyaXZlciIpOwoJCQkJCSBEYmNvbiBkYj1uZXcgRGJjb24oKTsKCQkJCQkgQ29ubmVjdGlvbiBjb25uZWN0PWRiLmdldENvbm5lY3Rpb24oKTsKCQkJCQkgU3RyaW5nIGsgOwoJCQkJCQlTdHJpbmcgZiA7CgkJCQkJCQoJCQkJCSBTaW1wbGVEYXRlRm9ybWF0IGRhdGVGb3JtYXQgPSBuZXcgU2ltcGxlRGF0ZUZvcm1hdCgiZGQvTU0veXl5eSIpOwoJCQkJICAgICAgIC8vZ2V0IGN1cnJlbnQgZGF0ZSB0aW1lIHdpdGggRGF0ZSgpCgkJCQkgICAgRGF0ZSBkYXRlID0gbmV3IERhdGUoKTsKCQkJCSAgICAgICAKCQkJCSAgICBTdHJpbmcgZHQ9ZGF0ZUZvcm1hdC5mb3JtYXQoZGF0ZSk7CgkJCQkgICAKCQkJCSAgICBSZXN1bHRTZXQgcjE9Y29ubmVjdC5jcmVhdGVTdGF0ZW1lbnQoKS5leGVjdXRlUXVlcnkoInNlbGVjdCAqIGZyb20ga2V5ZXhjaGFuZ2UiKTsKCQkJCQkKCQkJCQlpZihyMS5uZXh0KCk9PXRydWUpCgkJCQkJewoJCQkJCQlTdHJpbmcgZHNjaGVkdWxlZHQgPSByMS5nZXRTdHJpbmcoMSk7CgkJCQkJCQoJCQkJCQlpZihkdC5lcXVhbHNJZ25vcmVDYXNlKGRzY2hlZHVsZWR0KSkKCQkJCQkJewoJCQkJCQkJCgkJCQkJCQkgUmVzdWx0U2V0IHIyPWNvbm5lY3QuY3JlYXRlU3RhdGVtZW50KCkuZXhlY3V0ZVF1ZXJ5KCJzZWxlY3QgKiBmcm9tIGNsaWVudCIpOwoJCQkJCQkJCQoJCQkJCQkJCXdoaWxlKHIyLm5leHQoKT09dHJ1ZSkKCQkJCQkJCQl7CgkJCQkJCQkJCUdlbmVyYXRlIGcgPSBuZXcgR2VuZXJhdGUoKTsKCQkJCQkJCQkJZiA9IHIyLmdldFN0cmluZygiZm5hbWUiKTsKCQkJCQkJCQkJaz1nLmdlbigpOwoJCQkJCQkJCQkKCQkJCQkJCQkJU29ja2V0IHNjID0gbmV3IFNvY2tldCgibG9jYWxob3N0IiwxMTEpOwoJCQkJCQkJCQlEYXRhT3V0cHV0U3RyZWFtIGRvdXQgPSBuZXcgRGF0YU91dHB1dFN0cmVhbShzYy5nZXRPdXRwdXRTdHJlYW0oKSk7CgkJCQkJCQkJCWRvdXQud3JpdGVVVEYoZik7CgkJCQkJCQkJCWRvdXQud3JpdGVVVEYoayk7CgkJCQkJCQkJCQoJCQkJCQkJCQlEYXRhSW5wdXRTdHJlYW0gZGluID0gbmV3IERhdGFJbnB1dFN0cmVhbShzYy5nZXRJbnB1dFN0cmVhbSgpKTsKCQkJCQkJCQkJU3RyaW5nIGZpbGUgPSBkaW4ucmVhZFVURigpOwoJCQkJCQkJCQlTdHJpbmcga2V5ID0gZGluLnJlYWRVVEYoKTsKCQkJCQkJCQkJCgkJCQkJCQkJCVNvY2tldCBzYzEgPSBuZXcgU29ja2V0KCJsb2NhbGhvc3QiLDIyMik7CgkJCQkJCQkJCURhdGFPdXRwdXRTdHJlYW0gZG91dDEgPSBuZXcgRGF0YU91dHB1dFN0cmVhbShzYzEuZ2V0T3V0cHV0U3RyZWFtKCkpOwoJCQkJCQkJCQlkb3V0MS53cml0ZVVURihmaWxlKTsKCQkJCQkJCQkJZG91dDEud3JpdGVVVEYoa2V5KTsKCQkJCQkJCQkJCgkJCQkJCQkJCURhdGFJbnB1dFN0cmVhbSBkaW4xID0gbmV3IERhdGFJbnB1dFN0cmVhbShzYzEuZ2V0SW5wdXRTdHJlYW0oKSk7CgkJCQkJCQkJCVN0cmluZyBmaWxlMSA9IGRpbjEucmVhZFVURigpOwoJCQkJCQkJCQlTdHJpbmcga2V5MSA9IGRpbjEucmVhZFVURigpOwoJCQkJCQkJCQkKCQkJCQkJCQkJU29ja2V0IHNjMiA9IG5ldyBTb2NrZXQoImxvY2FsaG9zdCIsMzMzKTsKCQkJCQkJCQkJRGF0YU91dHB1dFN0cmVhbSBkb3V0MiA9IG5ldyBEYXRhT3V0cHV0U3RyZWFtKHNjMi5nZXRPdXRwdXRTdHJlYW0oKSk7CgkJCQkJCQkJCWRvdXQyLndyaXRlVVRGKGZpbGUxKTsKCQkJCQkJCQkJZG91dDIud3JpdGVVVEYoa2V5MSk7CgkJCQkJCQkJCQoJCQkJCQkJCQlEYXRhSW5wdXRTdHJlYW0gZGluMiA9IG5ldyBEYXRhSW5wdXRTdHJlYW0oc2MyLmdldElucHV0U3RyZWFtKCkpOwoJCQkJCQkJCQlTdHJpbmcgZmlsZTIgPSBkaW4yLnJlYWRVVEYoKTsKCQkJCQkJCQkJU3RyaW5nIGtleTI9IGRpbjIucmVhZFVURigpOwoJCQkJCQkJCQkKCQkJCQkJCQkJU3lzdGVtLm91dC5wcmludGxuKGZpbGUyKTsKCQkJCQkJCQkJU3lzdGVtLm91dC5wcmludGxuKGtleTIpOwoJCQkJCQkJCQkJCgkJCQkJCQkJCWNvbm5lY3QuY3JlYXRlU3RhdGVtZW50KCkuZXhlY3V0ZVVwZGF0ZSgiaW5zZXJ0IGludG8gS0RDKGZuYW1lLHNrLGR0KSB2YWx1ZXMgKCciK2YrIicsJyIraysiJywnIitkc2NoZWR1bGVkdCsiJykiKTsKCQkJCQkJCQkJCgkJCQkJCQkJCQoJCQkJCQkJCX0KCQkJCQkJCQkKCQkJCQkJfQoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlTeXN0ZW0ub3V0LnByaW50bG4oIkRhdGUiKTsKCQkJCQl9CgkJCQkgfWNhdGNoIChFeGNlcHRpb24gZSkgewoJCQkJCS8vIFRPRE86IGhhbmRsZSBleGNlcHRpb24KCQkJCX0KCQkJCQoJCQl9CgkJfSk7Cgl9CglwdWJsaWMgdm9pZCBhY3Rpb25QZXJmb3JtZWQoQWN0aW9uRXZlbnQgZSkgewoJCU9iamVjdCBvID0gZS5nZXRTb3VyY2UoKTsKCQkKCgkJaWYgKG8gPT0gYjEpIHsKCQkJCgkJCXRyeSB7CgoJCQkJVmVjdG9yIGhlYWRpbmcgPSBuZXcgVmVjdG9yKCk7CgoJCQkJaGVhZGluZy5hZGRFbGVtZW50KCJGaWxlIE5hbWUiKTsKCQkJCWhlYWRpbmcuYWRkRWxlbWVudCgiU2VjcmV0IEtleSIpOwoJCQkJaGVhZGluZy5hZGRFbGVtZW50KCJEYXRlIik7CgkJCQoJCQkJVmVjdG9yIGRhdGEgPSBuZXcgVmVjdG9yKCk7CgoJCQkJU3RyaW5nIHF1ZXJ5ID0gIlNFTEVDVCAqIEZST00ga2RjIjsKCgkJCQkKCQkJCURiY29uIGNvbj1uZXcgRGJjb24oKTsKCQkJCQoJCQkJUmVzdWx0U2V0IHJzID1jb24uZ2V0Q29ubmVjdGlvbigpLmNyZWF0ZVN0YXRlbWVudCgpLmV4ZWN1dGVRdWVyeShxdWVyeSk7CgkJCQkKCgkJCQlSZXN1bHRTZXRNZXRhRGF0YSByc20gPSBycy5nZXRNZXRhRGF0YSgpOwoJCQkJaW50IGNvbCA9IHJzbS5nZXRDb2x1bW5Db3VudCgpOwoKCQkJCXdoaWxlIChycy5uZXh0KCkpIHsKCQkJCQlWZWN0b3Igcm93ID0gbmV3IFZlY3RvcigpOwoJCQkJCWZvciAoaW50IGkgPSAxOyBpIDw9IGNvbDsgaSsrKSB7CgkJCQkJCXJvdy5hZGRFbGVtZW50KHJzLmdldE9iamVjdChpKSk7CgoJCQkJCX0KCgkJCQkJZGF0YS5hZGRFbGVtZW50KHJvdyk7CgkJCQl9CgoJCQkJSlRhYmxlIHRhYmxlID0gbmV3IEpUYWJsZShkYXRhLCBoZWFkaW5nKTsKCgkJCQlKU2Nyb2xsUGFuZSBwYW5lID0gbmV3IEpTY3JvbGxQYW5lKHRhYmxlKTsKCgkJCQlwYW5lLnNldEJvdW5kcygyMCwzMCw1MDAsMjUwKTsKCQkJCWMuYWRkKHBhbmUpOwoKCQkJfSBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7CgkJCQlleC5wcmludFN0YWNrVHJhY2UoKTsKCQl9CgkJCQoJCQl9CgkJCQoKCQlpZiAobyA9PSBpdGVtMikgewoJCQoJCQl0cnkKCQkJewoJCQkJU3RyaW5nIG5hbWUgPSBKT3B0aW9uUGFuZS5zaG93SW5wdXREaWFsb2coIlNjaGVkdWxlIERhdGUgKGRkL21tL3l5eXkpIik7CgkJCQkKCQkJCURiY29uIGRiID0gbmV3IERiY29uKCk7CgkJCQlDb25uZWN0aW9uIGNvbiA9IGRiLmdldENvbm5lY3Rpb24oKTsKCQkJCQoJCQkJU3RhdGVtZW50IHN0bXQgPSBjb24uY3JlYXRlU3RhdGVtZW50KCk7CgkJCQkKCQkJCVN0cmluZyBzcWwgPSAidXBkYXRlIGtleWV4Y2hhbmdlIHNldCBkdD0nIituYW1lKyInIjsKCQkJCXN0bXQuZXhlY3V0ZVVwZGF0ZShzcWwpOwoJCQkJSk9wdGlvblBhbmUuc2hvd01lc3NhZ2VEaWFsb2cobnVsbCwgIkRhdGUgQXNzaWduZWQgU3VjY2Vzc2Z1bGx5Iik7CgkJCQkKCQkJCQoJCQl9Y2F0Y2ggKEV4Y2VwdGlvbiBlNCkgewoJCQkJLy8gVE9ETzogaGFuZGxlIGV4Y2VwdGlvbgoJCQl9CgoJCX0KCQlpZiAobyA9PSBpdGVtMjIpIHsKCQkJCgkJCVZpZXdfS2V5X0V4Y2hhbmdlRGF0ZSB2MSA9bmV3IFZpZXdfS2V5X0V4Y2hhbmdlRGF0ZSgpOwoJCQl2MS5zZXRTaXplKDYwMCwgNDAwKTsKCQkJdjEuc2V0VmlzaWJsZSh0cnVlKTsKCQl9CgkJCgkJaWYobyA9PSBleGl0KQoJCXsKCQkJU3lzdGVtLmV4aXQoMCk7CgkJfQoJfQoKY2xhc3MgUG9ydExpc3RlbmVyIGltcGxlbWVudHMgUnVubmFibGUgewoJCQoJCWludCBwb3J0OwoKCQlwdWJsaWMgUG9ydExpc3RlbmVyKGludCBwb3J0KSB7CgkJCXRoaXMucG9ydCA9IHBvcnQ7CgkJfQoKCQlwdWJsaWMgdm9pZCBydW4oKSB7CgkJCQoJCQkKCQkJaWYgKHRoaXMucG9ydCA9PSAzNzg5KQoJCQl7CgoJCQkJdHJ5CgkJCQl7CgkJCQkJU2VydmVyU29ja2V0IHNlcnZlcjkwOSA9IG5ldyBTZXJ2ZXJTb2NrZXQoMzc4OSk7CgkJCQkJU29ja2V0IGNvbjc3NzsKCQkJCQkKCQkJCQkKCQkJCQl3aGlsZSAodHJ1ZSkgCgkJCQkJewoJCQkJCQkKCQkJCQljb243NzcgPSBzZXJ2ZXI5MDkuYWNjZXB0KCk7CgkJCQkJCgkJCQkJRGF0YUlucHV0U3RyZWFtIGRpbiA9IG5ldyBEYXRhSW5wdXRTdHJlYW0oY29uNzc3LmdldElucHV0U3RyZWFtKCkpOwoJCQkJCgkJCQkJU3RyaW5nIG5hbWUgPSBkaW4ucmVhZFVURigpOwoKCQkJCQlEYmNvbiBkYiA9IG5ldyBEYmNvbigpOwoJCQkJCUNvbm5lY3Rpb24gY29uID0gZGIuZ2V0Q29ubmVjdGlvbigpOwoJCQkJCQoJCQkJCVN0YXRlbWVudCBzdG10ID0gY29uLmNyZWF0ZVN0YXRlbWVudCgpOwoJCQkJCQoJCQkJCVN0cmluZyBzcWwgPSAidXBkYXRlIGtleWV4Y2hhbmdlIHNldCBkdD0nIituYW1lKyInIjsKCQkJCQlzdG10LmV4ZWN1dGVVcGRhdGUoc3FsKTsKCQkJCQkKCQkJCQkKCQkJCQlEYXRhT3V0cHV0U3RyZWFtIGRvczIgPSBuZXcgRGF0YU91dHB1dFN0cmVhbShjb243NzcuZ2V0T3V0cHV0U3RyZWFtKCkpOwoJCQkJCWRvczIud3JpdGVVVEYoIkFzc2lnbmVkIFN1Y2Nlc3NmdWxseSIpOwoJCQkJCQoJCQkJCX0KCQkJCX1jYXRjaCAoRXhjZXB0aW9uIGUpIHsKCQkJCQllLnByaW50U3RhY2tUcmFjZSgpOwoJCQkJfQoJCQkKCQkJCgkJCX0KCQkJaWYgKHRoaXMucG9ydCA9PSAxMzMzKQoJCQl7CgoJCQkJdHJ5CgkJCQl7CgkJCQkJU2VydmVyU29ja2V0IHNlcnZlcjkwOSA9IG5ldyBTZXJ2ZXJTb2NrZXQoMTMzMyk7CgkJCQkJU29ja2V0IGNvbjc3NzsKCQkJCQkKCQkJCQlEYmNvbiBkYj1uZXcgRGJjb24oKTsKCQkJCQlDb25uZWN0aW9uIGNvbm5lY3Q9ZGIuZ2V0Q29ubmVjdGlvbigpOwoJCQkJCXdoaWxlICh0cnVlKSAKCQkJCQl7CgkJCQkJCQoJCQkJCWNvbjc3NyA9IHNlcnZlcjkwOS5hY2NlcHQoKTsKCQkJCQkKCQkJCQlPYmplY3RJbnB1dFN0cmVhbSBpbjM9bmV3IE9iamVjdElucHV0U3RyZWFtKGNvbjc3Ny5nZXRJbnB1dFN0cmVhbSgpKTsKCQkJCQkKCQkJCQlTdHJpbmcgY3M9aW4zLnJlYWRPYmplY3QoKS50b1N0cmluZygpOwoJCQkJCQoJCQkJCVZlY3RvciBkYXRhID0gbmV3IFZlY3RvcigpOwoJCQkJCQoJCQkJCVJlc3VsdFNldCByMT1jb25uZWN0LmNyZWF0ZVN0YXRlbWVudCgpLmV4ZWN1dGVRdWVyeSgic2VsZWN0IGZuYW1lLHNrLGR0IGZyb20gS0RDIik7CgoJCQkJCVJlc3VsdFNldE1ldGFEYXRhIHJzbT1yMS5nZXRNZXRhRGF0YSgpOwoJCQkJCWludCBjb2w9cnNtLmdldENvbHVtbkNvdW50KCk7CgkJCQkJIAoJCQkJCXdoaWxlKHIxLm5leHQoKT09dHJ1ZSkKCQkJCQl7CgkJCQkJCVZlY3RvciByb3cgPSBuZXcgVmVjdG9yKCk7CgkJICAgICAgICAgICAgCWZvcihpbnQgaSA9IDE7IGkgPD1jb2w7IGkrKyl7CgkJICAgICAgICAgICAgICAgIHJvdy5hZGRFbGVtZW50KHIxLmdldE9iamVjdChpKSk7CgoJCSAgICAgICAgICAgICB9CgoJCSAgICAgICAgICAgIAlkYXRhLmFkZEVsZW1lbnQocm93KTsKCQkJCQl9CQovLwkJCQkJU3lzdGVtLm91dC5wcmludGxuKGRhdGEpOwoJCQkJCU9iamVjdE91dHB1dFN0cmVhbSBkb3V0ID0gbmV3IE9iamVjdE91dHB1dFN0cmVhbShjb243NzcuZ2V0T3V0cHV0U3RyZWFtKCkpOwoJCQkJCWRvdXQud3JpdGVPYmplY3QoZGF0YSk7CgkJCQkJCgkJCQkJfQoJCQkJfWNhdGNoIChFeGNlcHRpb24gZSkgewoJCQkJCWUucHJpbnRTdGFja1RyYWNlKCk7CgkJCQl9CgkJCQoJCQkKCQkJfQoJCX0KCgp9CgkKfQo=asdfadsfdasfdsa